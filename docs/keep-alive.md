# Glitch アプリケーションのキープアライブ設定

Glitch アプリケーションは一定時間アクセスがないとスリープ状態になります。これを防ぐため、Google Apps Script (GAS) を使用して定期的にヘルスチェックを行います。

## セットアップ手順

1. Google Apps Script プロジェクトの作成

   - [Google Apps Script](https://script.google.com/) にアクセス
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を「slack-keihi-keep-alive」などに設定

2. スクリプトのコピー

   - `scripts/keep-alive.gs` の内容をコピー
   - GAS エディタに貼り付け

3. 環境設定の変更

   - `GLITCH_APP_URL` は自動的に設定済み（https://slack2keihi.glitch.me）
   - `HEALTH_CHECK_INTERVAL` を必要に応じて調整（デフォルト: 5 分）

4. （オプション）通知設定

   - Slack 通知を有効にする場合は、`sendNotification` 関数のコメントアウトを解除
   - `SLACK_WEBHOOK_URL` を設定

5. トリガーの設定

   - スクリプトエディタで `setupTrigger` 関数を実行して定期実行を設定
   - または手動で以下のトリガーを設定:
     - 関数: `checkHealth`
     - イベントのソース: 「時間主導型」
     - 時間ベースのトリガーのタイプ: 「分ベースのタイマー」
     - 間隔: 5 分おき

   注意: このスクリプトはウェブアプリとしてデプロイする必要はありません。
   定期実行はトリガーによって自動的に行われ、手動実行はスクリプトエディタから直接実行できます。

## 動作確認

1. 手動チェック

   - スクリプトエディタで `manualCheck` 関数を実行
   - ログに結果が表示されることを確認

2. ヘルスチェックエンドポイントの確認

   ```bash
   # ローカル開発時
   curl http://localhost:3000/health

   # Glitch上
   curl https://slack2keihi.glitch.me/health
   ```

3. ログの確認
   - GAS の実行ログでヘルスチェックの結果を確認
   - エラーが発生した場合は通知が送信されることを確認

## トラブルシューティング

1. ヘルスチェックが失敗する場合

   - Glitch アプリケーションが正常に動作しているか確認
   - URL が正しく設定されているか確認
   - アプリケーションのログを確認

2. トリガーが動作しない場合

   - トリガーが正しく設定されているか確認
   - `setupTrigger` 関数を再実行
   - GAS のクォータ制限を確認

3. 通知が届かない場合
   - Slack Webhook URL が正しいか確認
   - Webhook の権限設定を確認
   - テスト通知を送信して動作確認

## 注意事項

- GAS の実行時間には制限があります（1 日あたり 6 時間）
- Webhook の情報は公開しないよう注意してください
- ヘルスチェックの間隔は短すぎると制限に引っかかる可能性があります
- Glitch の無料プランでは、完全な 24 時間稼働は保証されません
- このスクリプトはウェブアプリとしてデプロイする必要はありません
