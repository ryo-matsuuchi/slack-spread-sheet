# 実装計画

## 1. パッケージの追加

```bash
npm install pdf-lib sharp
```

## 2. ファイル構成

```
src/
  ├── services/
  │   ├── exportService.js  # 新規作成
  │   └── pdfService.js     # 新規作成（PDF操作用ユーティリティ）
  └── utils/
      └── imageUtils.js     # 新規作成（画像処理用ユーティリティ）
```

## 3. 実装順序

1. PDF 操作用ユーティリティの実装（pdfService.js）

   - PDF の作成
   - PDF の結合
   - しおりの追加
   - ページ番号の追加

2. 画像処理用ユーティリティの実装（imageUtils.js）

   - 画像のリサイズ
   - PDF への変換
   - 余白の追加

3. エクスポートサービスの実装（exportService.js）

   - スプレッドシートの PDF エクスポート
   - 領収書の取得と変換
   - PDF の結合
   - Google Drive への保存

4. Slack コマンドの実装（slackService.js）
   - export コマンドの追加
   - パラメータのバリデーション
   - エラーハンドリング

## 4. テスト計画

1. ユニットテスト

   - PDF 操作のテスト
   - 画像処理のテスト
   - エクスポート処理のテスト

2. 統合テスト
   - コマンド実行のテスト
   - Google API 連携のテスト
   - エラーケースのテスト

## 5. デプロイ手順

1. パッケージの追加

   ```bash
   cd /app
   npm install pdf-lib sharp
   ```

2. 環境変数の確認

   - Google API のスコープ
   - 必要な権限

3. アプリケーションの再起動
   ```bash
   refresh
   ```

## 6. エラー処理

1. PDF 生成エラー

   - スプレッドシートのエクスポート失敗
   - 領収書の取得失敗
   - PDF 結合失敗

2. 画像処理エラー

   - リサイズ失敗
   - PDF 変換失敗

3. Google Drive 関連エラー
   - アクセス権限エラー
   - ストレージ容量エラー

## 7. 監視とログ

1. ログ出力

   - PDF 生成の進捗
   - 領収書の処理状況
   - エラー詳細

2. パフォーマンス監視
   - 処理時間
   - メモリ使用量
   - エラー率

## 8. ドキュメント更新

1. README.md

   - 新コマンドの説明
   - 使用例の追加

2. トラブルシューティング
   - よくあるエラーと対処方法
   - PDF エクスポートに関する注意事項
