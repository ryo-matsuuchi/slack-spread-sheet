# Slack 経費精算ボット

Slack から経費情報を入力し、経費精算書（Google スプレッドシート）に自動で登録するボットです。

## 機能

### 領収書添付での経費登録

- 領収書・レシートのアップロード
- Google Drive へのファイル保存（ユーザー別のアクセス権限付き）
- スプレッドシートへの自動登録

### 直接入力での経費登録

- `/keihi`コマンドでの入力フォーム表示
- スプレッドシートへの自動登録

## セットアップ

1. 必要な環境変数の設定

   ```bash
   cp .env.example .env
   # .envファイルを編集して必要な値を設定
   ```

2. 依存関係のインストール

   ```bash
   npm install
   ```

3. アプリケーションの起動
   ```bash
   npm start
   ```

## 使い方

### 領収書添付での経費登録

1. Slack に領収書（PDF または画像）をアップロード
2. メッセージの「その他のアクション」から「経費精算書の作成」を選択
3. フォームに必要な情報を入力
   - 日付（任意、デフォルト：今日）
   - 金額（必須）
   - 利用目的/内容（任意）
   - 備考（任意）
4. 送信して完了

### 直接入力での経費登録

1. Slack で`/keihi`コマンドを実行
2. フォームに必要な情報を入力
   - 日付（任意、デフォルト：今日）
   - 金額（必須）
   - 利用目的/内容（任意）
   - 備考（任意）
3. 送信して完了

### コマンド一覧

- `/keihi` - 経費精算書の作成（直接入力）

## アーキテクチャ

```
[Slack]
   │
   ├── メッセージアクション ──┐
   │   (領収書添付)          │
   │                        │
   └── スラッシュコマンド ────┤
       (直接入力)           │
                           ▼
                    [Socket Mode]
                           │
                           ▼
                    [Node.jsサーバー]
                           │
               ┌──────────┴──────────┐
               │                     │
               ▼                     ▼
     [Google Drive]        [Googleスプレッドシート]
```

## セキュリティ

- Socket Mode による安全な通信
- Slack 署名の検証
- API トークンによる認証
- ユーザー別の Google Drive アクセス権限
- セキュリティヘッダーの適用

## 開発

1. 開発サーバーの起動

   ```bash
   npm run dev
   ```

2. テストの実行
   ```bash
   npm test
   ```

## 今後の予定

- OCR 機能の実装（現在は無効化）
- 月次レポート機能の追加
- 一括登録機能の追加

## ライセンス

MIT
